# Copyright 1999-2017 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2

EAPI=6

PYTHON_COMPAT=( python2_7 ) ## 3.x seems in the works. 

inherit python-single-r1
# distutils-r1

if [[ ${PV} == "9999" ]] ; then
	MY_P=${P}
	EGIT_REPO_URI="git://github.com/abaykan/CrawlBox.git"
	inherit git-r3
else
	MY_P=${PN}-${PV/_/-}
	SRC_URI="https://github.com/reverse-shell/crawlbox/archive/v${PV}.tar.gz"
	KEYWORDS="~alpha ~amd64 ~arm ~arm64 ~hppa ~ia64 ~m68k ~mips ~ppc ~ppc64 ~s390 ~sh ~sparc ~x86 ~amd64-linux ~arm-linux ~x86-linux"
fi

DESCRIPTION="Easy way to brute-force web directory."
HOMEPAGE="https://github.com/abaykan/CrawlBox"
LICENSE="BSD"
SLOT="0"
KEYWORDS=""

IUSE="-doc -desktopicons"
DEPEND="dev-python/requests
	dev-python/requests-ntlm
	dev-python/tldextract"
	# dev-python/fake-useragent
#https://pypi.org/project/fake-useragent/ https://github.com/hellysmile/fake-useragent/


RDEPEND="${DEPEND}"


S="${WORKDIR}/${P}"

src_prepare() {
# 
}

src_install() {
	dodir /opt/${PN}
	insinto  /opt/${PN}
	doins -r crawlbox/ crawlbox.py
	fperms +x /opt/${PN}/crawlbox.py
	dosym "${EPREFIX}"/opt/${PN}/crawlbox.py /usr/bin/crawlbox

	if use doc; then
		einstalldocs /usr/share/doc/${PN}/
		dodoc -r /{README.md,LICENSE}
	fi

	#FIXME: convert to desktop.eclass
	if use desktopicons; then
		dodir /usr/share/icons/${PN}/
		cp  ${FILES}/{crawlbox.png,crawlbox.svg}  /usr/share/icons/${PN}/
		dodir  /usr/share/applications/${PN}/
		cp ${FILES}*.desktop  /usr/share/applications/${PN}/
		fixperms +r +x /usr/share/applications/${PN}/*.desktop
	fi

}
